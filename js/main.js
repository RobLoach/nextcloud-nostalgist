(()=>{var e,t,a,s,n={13:(e,t,a)=>{"use strict";a.d(t,{x:()=>ge});var s=a(606),n=Object.defineProperty,r=(e,t,a)=>((e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a)(e,"symbol"!=typeof t?t+"":t,a);const o={gb:"mgba",gba:"mgba",gbc:"mgba",megadrive:"genesis_plus_gx",nes:"fceumm",snes:"snes9x"};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var c,l;var u,m;const h={ini:i(function(){if(l)return c;l=1;const{hasOwnProperty:e}=Object.prototype,t=(e,n={})=>{"string"==typeof n&&(n={section:n}),n.align=!0===n.align,n.newline=!0===n.newline,n.sort=!0===n.sort,n.whitespace=!0===n.whitespace||!0===n.align,n.platform=n.platform||void 0!==s&&s.platform,n.bracketedArray=!1!==n.bracketedArray;const r="win32"===n.platform?"\r\n":"\n",i=n.whitespace?" = ":"=",c=[],l=n.sort?Object.keys(e).sort():Object.keys(e);let u=0;n.align&&(u=o(l.filter((t=>null===e[t]||Array.isArray(e[t])||"object"!=typeof e[t])).map((t=>Array.isArray(e[t])?`${t}[]`:t)).concat([""]).reduce(((e,t)=>o(e).length>=o(t).length?e:t))).length);let m="";const h=n.bracketedArray?"[]":"";for(const t of l){const a=e[t];if(a&&Array.isArray(a))for(const e of a)m+=o(`${t}${h}`).padEnd(u," ")+i+o(e)+r;else a&&"object"==typeof a?c.push(t):m+=o(t).padEnd(u," ")+i+o(a)+r}n.section&&m.length&&(m="["+o(n.section)+"]"+(n.newline?r+r:r)+m);for(const s of c){const o=a(s,".").join("\\."),i=(n.section?n.section+".":"")+o,c=t(e[s],{...n,section:i});m.length&&c.length&&(m+=r),m+=c}return m};function a(e,t){var a=0,s=0,n=0,r=[];do{if(-1!==(n=e.indexOf(t,a))){if(a=n+t.length,n>0&&"\\"===e[n-1])continue;r.push(e.slice(s,n)),s=n+t.length}}while(-1!==n);return r.push(e.slice(s)),r}const n=(t,s={})=>{s.bracketedArray=!1!==s.bracketedArray;const n=Object.create(null);let r=n,o=null;const c=/^\[([^\]]*)\]\s*$|^([^=]+)(=(.*))?$/i,l=t.split(/[\r\n]+/g),u={};for(const t of l){if(!t||t.match(/^\s*[;#]/)||t.match(/^\s*$/))continue;const a=t.match(c);if(!a)continue;if(void 0!==a[1]){if(o=i(a[1]),"__proto__"===o){r=Object.create(null);continue}r=n[o]=n[o]||Object.create(null);continue}const l=i(a[2]);let m;s.bracketedArray?m=l.length>2&&"[]"===l.slice(-2):(u[l]=((null==u?void 0:u[l])||0)+1,m=u[l]>1);const h=m&&l.endsWith("[]")?l.slice(0,-2):l;if("__proto__"===h)continue;const p=!a[3]||i(a[4]),f="true"===p||"false"===p||"null"===p?JSON.parse(p):p;m&&(e.call(r,h)?Array.isArray(r[h])||(r[h]=[r[h]]):r[h]=[]),Array.isArray(r[h])?r[h].push(f):r[h]=f}const m=[];for(const t of Object.keys(n)){if(!e.call(n,t)||"object"!=typeof n[t]||Array.isArray(n[t]))continue;const s=a(t,".");r=n;const o=s.pop(),i=o.replace(/\\\./g,".");for(const t of s)"__proto__"!==t&&(e.call(r,t)&&"object"==typeof r[t]||(r[t]=Object.create(null)),r=r[t]);r===n&&i===o||(r[i]=n[t],m.push(t))}for(const e of m)delete n[e];return n},r=e=>e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'"),o=e=>"string"!=typeof e||e.match(/[=\r\n]/)||e.match(/^\[/)||e.length>1&&r(e)||e!==e.trim()?JSON.stringify(e):e.split(";").join("\\;").split("#").join("\\#"),i=e=>{if(e=(e||"").trim(),!r(e)){let t=!1,a="";for(let s=0,n=e.length;s<n;s++){const n=e.charAt(s);if(t)-1!=="\\;#".indexOf(n)?a+=n:a+="\\"+n,t=!1;else{if(-1!==";#".indexOf(n))break;"\\"===n?t=!0:a+=n}}return t&&(a+="\\"),a.trim()}"'"===e.charAt(0)&&(e=e.slice(1,-1));try{e=JSON.parse(e)}catch{}return e};return c={parse:n,decode:n,stringify:t,encode:t,safe:o,unsafe:i}}()),path:i(function(){if(m)return u;function e(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function t(e,t){for(var a,s="",n=0,r=-1,o=0,i=0;i<=e.length;++i){if(i<e.length)a=e.charCodeAt(i);else{if(47===a)break;a=47}if(47===a){if(r===i-1||1===o);else if(r!==i-1&&2===o){if(s.length<2||2!==n||46!==s.charCodeAt(s.length-1)||46!==s.charCodeAt(s.length-2))if(s.length>2){var c=s.lastIndexOf("/");if(c!==s.length-1){-1===c?(s="",n=0):n=(s=s.slice(0,c)).length-1-s.lastIndexOf("/"),r=i,o=0;continue}}else if(2===s.length||1===s.length){s="",n=0,r=i,o=0;continue}t&&(s.length>0?s+="/..":s="..",n=2)}else s.length>0?s+="/"+e.slice(r+1,i):s=e.slice(r+1,i),n=i-r-1;r=i,o=0}else 46===a&&-1!==o?++o:o=-1}return s}m=1;var a={resolve:function(){for(var a,n="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var i;o>=0?i=arguments[o]:(void 0===a&&(a=s.cwd()),i=a),e(i),0!==i.length&&(n=i+"/"+n,r=47===i.charCodeAt(0))}return n=t(n,!r),r?n.length>0?"/"+n:"/":n.length>0?n:"."},normalize:function(a){if(e(a),0===a.length)return".";var s=47===a.charCodeAt(0),n=47===a.charCodeAt(a.length-1);return 0!==(a=t(a,!s)).length||s||(a="."),a.length>0&&n&&(a+="/"),s?"/"+a:a},isAbsolute:function(t){return e(t),t.length>0&&47===t.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var t,s=0;s<arguments.length;++s){var n=arguments[s];e(n),n.length>0&&(void 0===t?t=n:t+="/"+n)}return void 0===t?".":a.normalize(t)},relative:function(t,s){if(e(t),e(s),t===s)return"";if((t=a.resolve(t))===(s=a.resolve(s)))return"";for(var n=1;n<t.length&&47===t.charCodeAt(n);++n);for(var r=t.length,o=r-n,i=1;i<s.length&&47===s.charCodeAt(i);++i);for(var c=s.length-i,l=o<c?o:c,u=-1,m=0;m<=l;++m){if(m===l){if(c>l){if(47===s.charCodeAt(i+m))return s.slice(i+m+1);if(0===m)return s.slice(i+m)}else o>l&&(47===t.charCodeAt(n+m)?u=m:0===m&&(u=0));break}var h=t.charCodeAt(n+m);if(h!==s.charCodeAt(i+m))break;47===h&&(u=m)}var p="";for(m=n+u+1;m<=r;++m)m!==r&&47!==t.charCodeAt(m)||(0===p.length?p+="..":p+="/..");return p.length>0?p+s.slice(i+u):(i+=u,47===s.charCodeAt(i)&&++i,s.slice(i))},_makeLong:function(e){return e},dirname:function(t){if(e(t),0===t.length)return".";for(var a=t.charCodeAt(0),s=47===a,n=-1,r=!0,o=t.length-1;o>=1;--o)if(47===(a=t.charCodeAt(o))){if(!r){n=o;break}}else r=!1;return-1===n?s?"/":".":s&&1===n?"//":t.slice(0,n)},basename:function(t,a){if(void 0!==a&&"string"!=typeof a)throw new TypeError('"ext" argument must be a string');e(t);var s,n=0,r=-1,o=!0;if(void 0!==a&&a.length>0&&a.length<=t.length){if(a.length===t.length&&a===t)return"";var i=a.length-1,c=-1;for(s=t.length-1;s>=0;--s){var l=t.charCodeAt(s);if(47===l){if(!o){n=s+1;break}}else-1===c&&(o=!1,c=s+1),i>=0&&(l===a.charCodeAt(i)?-1==--i&&(r=s):(i=-1,r=c))}return n===r?r=c:-1===r&&(r=t.length),t.slice(n,r)}for(s=t.length-1;s>=0;--s)if(47===t.charCodeAt(s)){if(!o){n=s+1;break}}else-1===r&&(o=!1,r=s+1);return-1===r?"":t.slice(n,r)},extname:function(t){e(t);for(var a=-1,s=0,n=-1,r=!0,o=0,i=t.length-1;i>=0;--i){var c=t.charCodeAt(i);if(47!==c)-1===n&&(r=!1,n=i+1),46===c?-1===a?a=i:1!==o&&(o=1):-1!==a&&(o=-1);else if(!r){s=i+1;break}}return-1===a||-1===n||0===o||1===o&&a===n-1&&a===s+1?"":t.slice(a,n)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var a=t.dir||t.root,s=t.base||(t.name||"")+(t.ext||"");return a?a===t.root?a+s:a+e+s:s}("/",e)},parse:function(t){e(t);var a={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return a;var s,n=t.charCodeAt(0),r=47===n;r?(a.root="/",s=1):s=0;for(var o=-1,i=0,c=-1,l=!0,u=t.length-1,m=0;u>=s;--u)if(47!==(n=t.charCodeAt(u)))-1===c&&(l=!1,c=u+1),46===n?-1===o?o=u:1!==m&&(m=1):-1!==o&&(m=-1);else if(!l){i=u+1;break}return-1===o||-1===c||0===m||1===m&&o===c-1&&o===i+1?-1!==c&&(a.base=a.name=0===i&&r?t.slice(1,c):t.slice(i,c)):(0===i&&r?(a.name=t.slice(1,o),a.base=t.slice(1,c)):(a.name=t.slice(i,o),a.base=t.slice(i,c)),a.ext=t.slice(o,c)),i>0?a.dir=t.slice(0,i-1):r&&(a.dir="/"),a},sep:"/",delimiter:":",win32:null,posix:null};return a.posix=a,u=a}())},{path:p}=h,f=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,d=/[?/#]/;function g(e){return"function"==typeof globalThis.URL&&e instanceof globalThis.URL}function y(e){return"function"==typeof globalThis.Request&&e instanceof globalThis.Request}function v(e){return function(e){if("string"!=typeof e)return!1;if(["http://","https://","data:","blob:","./","../"].some((t=>e.startsWith(t))))return!0;if(["#","{"].some((t=>e.startsWith(t))))return!1;if(e.includes("\n"))return!1;const t=e.split(d);return!(t.length<2)&&t.every((e=>e.length<100))}(e)||g(e)||y(e)}class b{constructor({blobType:e,name:t,raw:a,signal:s,urlResolver:n}){r(this,"name",""),r(this,"arrayBuffer"),r(this,"blob"),r(this,"blobType","application/octet-stream"),r(this,"objectUrl"),r(this,"raw"),r(this,"signal"),r(this,"text"),r(this,"uint8Array"),r(this,"urlResolver"),this.raw=a,s&&(this.signal=s),n&&(this.urlResolver=n),e&&(this.blobType=e),t&&(this.name=x(t))}get baseName(){return p.parse(this.name).name}get extension(){return p.parse(this.name).ext}static async create(e){if(C(e))throw new Error("parameter is not valid");if(e instanceof b)return e;const t=new b("object"==typeof e&&"raw"in e?e:{raw:e});return await t.load(),t}dispose(){"string"==typeof this.objectUrl&&URL.revokeObjectURL(this.objectUrl)}async getArrayBuffer(){return this.arrayBuffer||(this.arrayBuffer=await this.getBlob().arrayBuffer()),this.arrayBuffer}getBlob(){if(!this.blob)throw new Error("blob is not available");return this.blob}getObjectUrl(){return this.objectUrl||(this.objectUrl=URL.createObjectURL(this.getBlob())),this.objectUrl}async getText(){return void 0!==this.text||(this.text=await this.getBlob().text()),this.text}async getUint8Array(){if(this.uint8Array)return this.uint8Array;const e=await this.getArrayBuffer();return this.uint8Array=new Uint8Array(e),this.uint8Array}async load(){const e=await P(this.urlResolver?this.urlResolver(this):this.raw);await this.loadContent(e)}loadArrayBuffer(e){this.arrayBuffer=e,this.blob=new Blob([e],{type:this.blobType})}async loadContent(e){if(t=e,"function"==typeof globalThis.Blob&&t instanceof globalThis.Blob)this.blob=e;else if(v(e))await this.loadFetchable(e);else if("string"==typeof e)this.loadPlainText(e);else if(j(null==e?void 0:e.fileContent))await this.loadObject(e);else if(function(e){return"function"==typeof globalThis.ArrayBuffer&&e instanceof globalThis.ArrayBuffer}(e))this.loadArrayBuffer(e);else if(function(e){return"function"==typeof globalThis.Uint8Array&&e instanceof globalThis.Uint8Array}(e))this.loadUint8Array(e);else if(function(e){return"function"==typeof globalThis.Response&&e instanceof globalThis.Response}(e))await this.loadResponse(e);else{if(!function(e){return"function"==typeof globalThis.FileSystemFileHandle&&e instanceof globalThis.FileSystemFileHandle}(e))throw new TypeError("failed to resolve the file, file content:",e);await this.loadFileSystemFileHandle(e)}var t;const a=function(e){return!(80!==e[0]||75!==e[1]||3!==e[2]&&5!==e[2]&&7!==e[2]||4!==e[3]&&6!==e[3]&&8!==e[3])}(await this.getUint8Array())?"zip":"bin";this.name||(this.name=E(a))}async loadFetchable(e){y(e)?this.name||(this.name=x(e.url)):g(e)?this.name||(this.name=x(e.href)):this.name||(this.name=x(e));const t=await fetch(e,{signal:this.signal||null});await this.loadResponse(t)}async loadFileSystemFileHandle(e){const t=await e.getFile();this.blob=t,this.name=x(t.name)}async loadObject(e){let{fileContent:t,fileName:a}=e;[a,t]=await Promise.all([P(a),P(t)]),this.name||(this.name=x(a)),await this.loadContent(t)}loadPlainText(e){this.blob=new Blob([e],{type:this.blobType})}async loadResponse(e){var t,a;const s=e.headers.get("Content-Disposition");if(s){const e=null==(a=null==(t=f.exec(s))?void 0:t[1])?void 0:a.replace(/['"]/g,"");e&&(this.name||(this.name=x(e)))}this.blob=await e.blob(),this.name||(this.name=x(e.url))}loadUint8Array(e){this.uint8Array=e,this.blob=new Blob([e],{type:this.blobType})}}const{path:w}=h,_=new TextEncoder;let S=0;function E(e="bin"){return`data${S+=1,S}.${e}`}function x(e){let t=function(e){let t=e;try{t=new URL(e).pathname}catch{}const a=w.basename(t);try{return decodeURIComponent(a)}catch{return a}}(e)||"";t=t.replaceAll(/["%*/:<>?\\|]/g,"-");return w.parse(t).ext?t:""}function A(e){return new Promise((t=>{setTimeout(t,e)}))}function C(e){return null==e}function k(e){return!C(e)&&(e.constructor===Object||!e.constructor)}function F(e,t,a){const s=e[a],n=t[a];C(s)?e[a]=n:Array.isArray(s)&&Array.isArray(n)?e[a]=[...s,...n]:k(s)&&k(n)?(e[a]=k(s)?e[a]:{},T(e[a],n)):e[a]=n}function T(e,...t){if(1===t.length){const[a]=t;for(const t in a)F(e,a,t)}else for(const a of t)T(e,a)}function M(e){if(null==e?void 0:e.aborted)throw new Error("Launch aborted")}function N(e){return(e<10?"0":"")+e}async function P(e){return e?"function"==typeof(null==e?void 0:e.then)?P(await e):"function"==typeof e?P(e()):e:e}const G=[globalThis.Response,globalThis.Uint8Array,globalThis.URL,globalThis.Request,globalThis.Response,globalThis.FileSystemFileHandle];function j(e){return G.some((t=>t&&e instanceof t))}function O(e){return"string"==typeof e||("fileContent"in e||(Array.isArray(e)?e.every((e=>O(e))):j(e)))}const{path:R}=h;const B="https://cdn.jsdelivr.net/gh",L="arianrhodsandlot/retroarch-emscripten-build",D="v1.20.0",$="retroarch",U="libretro/glsl-shaders",I="821487";function z(){return{element:"",retroarchConfig:{menu_driver:"rgui",menu_navigation_browser_filter_supported_extensions_enable:!1,notification_show_when_menu_is_alive:!0,savestate_auto_load:!0,savestate_thumbnail_enable:!0,stdin_cmd_enable:!0,video_shader_enable:!0,input_audio_mute:"nul",input_cheat_index_minus:"nul",input_cheat_index_plus:"nul",input_cheat_toggle:"nul",input_desktop_menu_toggle:"nul",input_exit_emulator:"nul",input_fps_toggle:"nul",input_frame_advance:"nul",input_game_focus_toggle:"nul",input_grab_mouse_toggle:"nul",input_hold_fast_forward:"nul",input_hold_slowmotion:"nul",input_load_state:"nul",input_netplay_game_watch:"nul",input_netplay_player_chat:"nul",input_pause_toggle:"nul",input_reset:"nul",input_rewind:"nul",input_save_state:"nul",input_screenshot:"nul",input_shader_next:"nul",input_shader_prev:"nul",input_shader_toggle:"nul",input_state_slot_decrease:"nul",input_state_slot_increase:"nul",input_toggle_fast_forward:"nul",input_toggle_fullscreen:"nul",input_volume_down:"nul",input_volume_up:"nul",input_player1_analog_dpad_mode:1,input_player2_analog_dpad_mode:1,input_player3_analog_dpad_mode:1,input_player4_analog_dpad_mode:1},retroarchCoreConfig:{},runEmulatorManually:!1,setupEmulatorManually:!1,resolveCoreJs:e=>`${B}/${L}@${D}/${$}/${e}_libretro.js`,resolveCoreWasm:e=>`${B}/${L}@${D}/${$}/${e}_libretro.wasm`,resolveRom(e){if("string"!=typeof e)return e||[];if((t=e)&&"string"==typeof t&&["http://","https://","//","data:","blob:"].some((e=>t.startsWith(e))))return e;var t;const a={".bin":"retrobrews/md-games",".gb":"retrobrews/gbc-games",".gba":"retrobrews/gba-games",".gbc":"retrobrews/gbc-games",".md":"retrobrews/md-games",".nes":"retrobrews/nes-games",".sfc":"retrobrews/snes-games",".sms":"retrobrews/sms-games"}[R.extname(e)];if(a){const t=encodeURIComponent(e);return`${B}/${a}@master/${t}`}return e},resolveBios:e=>e,resolveShader(e){if(!e)return[];const t=`${B}/${U}@${I}/${e}.glslp`,a=e.split(R.sep);a.splice(-1,0,"shaders");return[t,`${B}/${U}@${I}/${a.join(R.sep)}.glsl`]}}}let V=z();function q(){return V}function W(e){return"string"==typeof e||function(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)}(e)}function H(){return{bios:new Map,core:new Map,rom:new Map,shader:new Map}}const X=class e{constructor(e){if(r(this,"beforeLaunch"),r(this,"bios",[]),r(this,"cache",{bios:!1,core:!1,rom:!1,shader:!1}),r(this,"core",{}),r(this,"element"),r(this,"emscriptenModule"),r(this,"respondToGlobalEvents"),r(this,"rom",[]),r(this,"shader",[]),r(this,"signal"),r(this,"size"),r(this,"sram"),r(this,"state"),r(this,"waitForInteraction"),r(this,"loadPromises",[]),r(this,"nostalgistOptions"),this.nostalgistOptions=e,this.emscriptenModule=e.emscriptenModule??{},this.respondToGlobalEvents=e.respondToGlobalEvents??!0,this.signal=e.signal,this.size=e.size??"auto",this.waitForInteraction=e.waitForInteraction,this.element=this.getElement(),"boolean"==typeof e.cache)for(const t in this.cache)this.cache[t]=e.cache;else Object.assign(this.cache,e.cache)}get retroarchConfig(){const e={};return T(e,q().retroarchConfig,this.nostalgistOptions.retroarchConfig),e}get retroarchCoreConfig(){const e={};return T(e,q().retroarchCoreConfig,this.nostalgistOptions.retroarchCoreConfig),e}get style(){const{element:e,style:t}=this.nostalgistOptions,a={backgroundColor:"black",imageRendering:"pixelated"};if(e)return T(a,t),a;const s={height:"100%",left:"0",position:"fixed",top:"0",width:"100%",zIndex:"1"};return T(s,a,t),s}static async create(t){const a=new e(t);return await a.load(),a}static resetCacheStore(){Object.assign(e.cacheStorage,H())}async load(){this.loadFromCache(),await Promise.all([...this.loadPromises,this.updateState(),this.updateSRAM()]),this.saveToCache()}loadFromCache(){const t=[],a={bios:this.updateBios,core:this.updateCore,rom:this.updateRom,shader:this.updateShader};for(const s in this.cache){const n=s;if(this.cache[n]){const t=e.cacheStorage[n],a=this.nostalgistOptions[n];if(W(a)){const e=t.get(a);if(e){this[n]=e;continue}}}const r=a[n].call(this);t.push(r)}this.loadPromises=t}saveToCache(){for(const t in this.cache){const a=t;if(this.cache[a]){const t=e.cacheStorage[a],s=this.nostalgistOptions[a],n=this[a];W(s)&&n&&t.set(s,n)}}}async updateSRAM(){this.nostalgistOptions.sram&&(this.sram=await b.create(this.nostalgistOptions.sram))}async updateState(){this.nostalgistOptions.state&&(this.state=await b.create(this.nostalgistOptions.state))}getElement(){if("object"!=typeof document)throw new TypeError("document must be an object");let{element:e}=this.nostalgistOptions;if("string"==typeof e&&e){const t=document.body.querySelector(e);if(!t)throw new Error(`can not find element "${e}"`);if(!(t instanceof HTMLCanvasElement))throw new TypeError(`element "${e}" is not a canvas element`);e=t}if(e||(e=document.createElement("canvas")),e instanceof HTMLCanvasElement)return e.id="canvas",e;throw new TypeError("invalid element")}async updateBios(){let{bios:e,resolveBios:t}=this.nostalgistOptions;if(!e)return;if(e=await P(e),!e)return;const a=Array.isArray(e)?e:[e];this.bios=await Promise.all(a.map((e=>b.create("string"==typeof e?{raw:e,signal:this.signal,urlResolver:()=>t(e,this.nostalgistOptions)}:{raw:e,signal:this.signal}))))}async updateCore(){const{core:e,resolveCoreJs:t,resolveCoreWasm:a}=this.nostalgistOptions;if("object"==typeof e&&"js"in e&&"name"in e&&"wasm"in e){const[t,a]=await Promise.all([b.create(e.js),b.create(e.wasm)]);return void(this.core={js:t,name:e.name,wasm:a})}const[s,n]=await Promise.all([t,a].map((t=>b.create({raw:e,signal:this.signal,urlResolver:()=>t(e,this.nostalgistOptions)})))),r="string"==typeof e?e:s.name;this.core={js:s,name:r,wasm:n}}async updateRom(){let{resolveRom:e,rom:t}=this.nostalgistOptions;if(!t)return;if(t=await P(t),!t)return;const a=Array.isArray(t)?t:[t];this.rom=await Promise.all(a.map((t=>b.create("string"==typeof t?{raw:t,signal:this.signal,urlResolver:()=>e(t,this.nostalgistOptions)}:{raw:t,signal:this.signal}))));for(const e of this.rom)e.name||(e.name=E())}async updateShader(){let{resolveShader:e,shader:t}=this.nostalgistOptions;if(!t)return;if(t=await P(t),!t)return;let a=await e(t,this.nostalgistOptions);if(!a)return;if(a=await P(a),!a)return;const s=Array.isArray(a)?a:[a];this.shader=await Promise.all(s.map((e=>b.create({raw:e,signal:this.signal}))))}};r(X,"cacheStorage",H());let J=X;const K={2048:{savestate:!0,supportsNoGame:!0},"3dengine":{corename:"3DEngine"},"4do":{corename:"4DO",savestate:!0},81:{savestate:!0},a5200:{savestate:!0},advanced_tests:{corename:"Advanced Test",supportsNoGame:!0},ardens:{corename:"Ardens",savestate:!0},arduous:{corename:"Arduous"},atari800:{corename:"Atari800",savestate:!0},bk:{savestate:!0},blastem:{corename:"BlastEm",savestate:!0},bluemsx:{corename:"blueMSX",savestate:!0},bnes:{corename:"bnes/higan",savestate:!0},boom3:{},boom3_xp:{},bsnes:{savestate:!0},bsnes_cplusplus98:{cheats:!0,corename:"bsnes C++98 (v085)",savestate:!0},bsnes_hd_beta:{corename:"bsnes-hd beta",savestate:!0},bsnes_mercury_accuracy:{cheats:!0,corename:"bsnes-mercury Accuracy",savestate:!0},bsnes_mercury_balanced:{cheats:!0,corename:"bsnes-mercury Balanced",savestate:!0},bsnes_mercury_performance:{cheats:!0,corename:"bsnes-mercury Performance",savestate:!0},bsnes2014_accuracy:{cheats:!0,corename:"bsnes 2014 Accuracy",savestate:!0},bsnes2014_balanced:{cheats:!0,corename:"bsnes 2014 Balanced",savestate:!0},bsnes2014_performance:{cheats:!0,corename:"bsnes 2014 Performance",savestate:!0},cannonball:{corename:"Cannonball",supportsNoGame:!0},cap32:{corename:"Caprice32",savestate:!0,supportsNoGame:!0},cdi2015:{corename:"Philips CDi 2015"},chailove:{cheats:!0,corename:"ChaiLove",savestate:!0},chimerasnes:{cheats:!0,corename:"ChimeraSNES",savestate:!0},citra:{corename:"Citra",savestate:!0},citra_canary:{corename:"Citra Canary/Experimental"},citra2018:{corename:"Citra 2018"},craft:{corename:"Craft",supportsNoGame:!0},crocods:{corename:"CrocoDS",savestate:!0},cruzes:{corename:"Cruzes",supportsNoGame:!0},daphne:{corename:"Daphne"},desmume:{cheats:!0,corename:"DeSmuME",savestate:!0},desmume2015:{cheats:!0,corename:"DeSmuME 2015",savestate:!0},dinothawr:{corename:"Dinothawr",supportsNoGame:!0},directxbox:{corename:"DirectXBox"},dirksimple:{corename:"DirkSimple",savestate:!0},dolphin:{corename:"Dolphin",savestate:!0},dolphin_launcher:{corename:"Dolphin Launcher",supportsNoGame:!0},dosbox:{corename:"DOSBox",supportsNoGame:!0},dosbox_core:{corename:"DOSBox-core",supportsNoGame:!0},dosbox_pure:{cheats:!0,corename:"DOSBox-pure",savestate:!0,supportsNoGame:!0},dosbox_svn:{corename:"DOSBox-SVN",supportsNoGame:!0},dosbox_svn_ce:{corename:"DOSBox-SVN CE",supportsNoGame:!0},duckstation:{corename:"DuckStation",savestate:!0},easyrpg:{corename:"EasyRPG Player"},ecwolf:{corename:"ECWolf",savestate:!0},emuscv:{corename:"EmuSCV",supportsNoGame:!0},emux_chip8:{corename:"Emux CHIP-8"},emux_gb:{corename:"Emux GB"},emux_nes:{corename:"Emux NES"},emux_sms:{corename:"Emux SMS"},ep128emu_core:{cheats:!0,corename:"ep128emu-core",savestate:!0,supportsNoGame:!0},fake08:{corename:"FAKE-08",savestate:!0},fbalpha2012:{corename:"FB Alpha 2012",savestate:!0},fbalpha2012_cps1:{corename:"FB Alpha 2012 CPS-1",savestate:!0},fbalpha2012_cps2:{corename:"FB Alpha 2012 CPS-2",savestate:!0},fbalpha2012_cps3:{corename:"FB Alpha 2012 CPS-3",savestate:!0},fbalpha2012_neogeo:{corename:"FB Alpha 2012 Neo Geo",savestate:!0},fbneo:{cheats:!0,corename:"FinalBurn Neo",savestate:!0},fceumm:{cheats:!0,corename:"FCEUmm",savestate:!0},ffmpeg:{corename:"FFmpeg"},fixgb:{corename:"fixGB"},fixnes:{corename:"fixNES"},flycast:{corename:"Flycast",savestate:!0},flycast_gles2:{corename:"Flycast GLES2",savestate:!0},fmsx:{corename:"fMSX"},freechaf:{corename:"FreeChaF"},freeintv:{corename:"FreeIntv"},freej2me:{corename:"FreeJ2ME"},frodo:{corename:"Frodo"},fsuae:{corename:"FS-UAE"},fuse:{corename:"Fuse"},galaksija:{supportsNoGame:!0},gambatte:{corename:"Gambatte",savestate:!0},gearboy:{corename:"Gearboy"},gearcoleco:{corename:"Gearcoleco"},gearsystem:{corename:"Gearsystem"},genesis_plus_gx:{cheats:!0,corename:"Genesis Plus GX",savestate:!0},genesis_plus_gx_wide:{cheats:!0,corename:"Genesis Plus GX Wide",savestate:!0},gme:{corename:"Game Music Emu"},gong:{corename:"Gong",savestate:!0,supportsNoGame:!0},gpsp:{corename:"gpSP",savestate:!0},gw:{corename:"GW"},handy:{corename:"Handy",savestate:!0},hatari:{corename:"Hatari",savestate:!0},hbmame:{corename:"HBMAME (Git)"},higan_sfc:{corename:"nSide (Super Famicom Accuracy)",savestate:!0},higan_sfc_balanced:{corename:"nSide (Super Famicom Balanced)",savestate:!0},imageviewer:{corename:"Imageviewer"},ishiiruka:{corename:"Ishiiruka",savestate:!0},jaxe:{corename:"JAXE"},jumpnbump:{corename:"jumpnbump"},kronos:{cheats:!0,corename:"Kronos",savestate:!0},lowresnx:{corename:"lowresnx"},lutro:{corename:"Lutro"},mame:{corename:"MAME",savestate:!0},mame2000:{corename:"MAME 2000 (0.37b5)",savestate:!0},mame2003:{corename:"MAME 2003 (0.78)",savestate:!0},mame2003_midway:{corename:"MAME 2003 Midway (0.78)",savestate:!0},mame2003_plus:{corename:"MAME 2003-Plus",savestate:!0},mame2009:{corename:"MAME 2009 (0.135u4)"},mame2010:{corename:"MAME 2010 (0.139)"},mame2015:{corename:"MAME 2015 (0.160)"},mame2016:{corename:"MAME 2016 (0.174)"},mamearcade:{corename:"MAME (Git)"},mamemess:{corename:"MESS (Git)",savestate:!0},mednafen_gba:{corename:"Beetle GBA"},mednafen_lynx:{corename:"Beetle Lynx"},mednafen_ngp:{corename:"Beetle NeoPop",savestate:!0},mednafen_pce:{corename:"Beetle PCE",savestate:!0},mednafen_pce_fast:{corename:"Beetle PCE Fast",savestate:!0},mednafen_pcfx:{corename:"Beetle PC-FX"},mednafen_psx:{cheats:!0,corename:"Beetle PSX",savestate:!0},mednafen_psx_hw:{cheats:!0,corename:"Beetle PSX HW",savestate:!0},mednafen_saturn:{cheats:!0,corename:"Beetle Saturn",savestate:!0},mednafen_snes:{corename:"Beetle bsnes",savestate:!0},mednafen_supafaust:{cheats:!0,corename:"Beetle Supafaust",savestate:!0},mednafen_supergrafx:{cheats:!0,corename:"Beetle SuperGrafx",savestate:!0},mednafen_vb:{corename:"Beetle VB"},mednafen_wswan:{corename:"Beetle WonderSwan",savestate:!0},melonds:{corename:"melonDS"},mesen:{cheats:!0,corename:"Mesen",savestate:!0},"mesen-s":{corename:"Mesen-S"},mess2015:{corename:"MESS 2015 (0.160)"},meteor:{corename:"Meteor"},mgba:{cheats:!0,corename:"mGBA",savestate:!0},minivmac:{corename:"MinivmacII"},mojozork:{corename:"mojozork",savestate:!0},moonlight:{corename:"Moonlight",supportsNoGame:!0},mpv:{corename:"MPV"},mrboom:{corename:"Mr.Boom",savestate:!0,supportsNoGame:!0},mu:{corename:"Mu",supportsNoGame:!0},mupen64plus_next:{cheats:!0,corename:"Mupen64Plus-Next",savestate:!0},mupen64plus_next_develop:{cheats:!0,corename:"Mupen64Plus-Next",savestate:!0},mupen64plus_next_gles2:{cheats:!0,corename:"Mupen64Plus-Next",savestate:!0},mupen64plus_next_gles3:{cheats:!0,corename:"Mupen64Plus-Next",savestate:!0},nekop2:{corename:"Neko Project II",savestate:!0},neocd:{corename:"NeoCD"},nes:{savestate:!0},nestopia:{cheats:!0,corename:"Nestopia",savestate:!0},np2kai:{corename:"Neko Project II Kai",savestate:!0},numero:{corename:"Numero",savestate:!0,supportsNoGame:!0},nxengine:{corename:"NXEngine",supportsNoGame:!0},o2em:{corename:"O2EM",savestate:!0},oberon:{corename:"Oberon"},openlara:{corename:"OpenLara"},opentyrian:{corename:"OpenTyrian",supportsNoGame:!0},opera:{corename:"Opera",savestate:!0,supportsNoGame:!0},parallel_n64:{corename:"ParaLLEl N64",savestate:!0},parallel_n64_debug:{corename:"ParaLLEl (Debug)",savestate:!0},pascal_pong:{corename:"PascalPong",supportsNoGame:!0},pcem:{corename:"PCem",supportsNoGame:!0},pcsx_rearmed:{cheats:!0,corename:"PCSX-ReARMed",savestate:!0},pcsx_rearmed_interpreter:{cheats:!0,corename:"PCSX ReARMed [Interpreter]",savestate:!0},pcsx_rearmed_neon:{cheats:!0,corename:"PCSX ReARMed [NEON]",savestate:!0},pcsx1:{corename:"PCSX1"},pcsx2:{corename:"LRPS2",savestate:!0},picodrive:{cheats:!0,corename:"PicoDrive",savestate:!0},play:{corename:"Play!",savestate:!0},pocketcdg:{corename:"PocketCDG"},pokemini:{corename:"PokeMini",savestate:!0},potator:{corename:"Potator",savestate:!0},ppsspp:{corename:"PPSSPP",savestate:!0},prboom:{cheats:!0,corename:"PrBoom",savestate:!0},prosystem:{corename:"ProSystem",savestate:!0},puae:{cheats:!0,corename:"PUAE",savestate:!0,supportsNoGame:!0},puae2021:{cheats:!0,corename:"PUAE 2021",savestate:!0,supportsNoGame:!0},puzzlescript:{corename:"puzzlescript",savestate:!0},px68k:{corename:"PX68k",supportsNoGame:!0},quasi88:{cheats:!0,corename:"QUASI88",savestate:!0,supportsNoGame:!0},quicknes:{corename:"QuickNES",savestate:!0},race:{corename:"RACE",savestate:!0},redbook:{corename:"Redbook"},reminiscence:{corename:"REminiscence",savestate:!0},remotejoy:{corename:"RemoteJoy",supportsNoGame:!0},retro8:{corename:"Retro8"},retrodream:{corename:"RetroDream"},rustation:{corename:"Rustation"},same_cdi:{corename:"SAME CDi (Git)"},sameboy:{corename:"SameBoy"},sameduck:{corename:"SameDuck",savestate:!0},scummvm:{corename:"ScummVM",supportsNoGame:!0},simcp:{corename:"SimCoupe"},smsplus:{corename:"SMS Plus GX"},snes9x:{cheats:!0,corename:"Snes9x",savestate:!0},snes9x2002:{cheats:!0,corename:"Snes9x 2002",savestate:!0},snes9x2005:{cheats:!0,corename:"Snes9x 2005",savestate:!0},snes9x2005_plus:{cheats:!0,corename:"Snes9x 2005 Plus",savestate:!0},snes9x2010:{cheats:!0,corename:"Snes9x 2010",savestate:!0},squirreljme:{corename:"SquirrelJME",supportsNoGame:!0},stella:{corename:"Stella",savestate:!0},stella2014:{corename:"Stella 2014",savestate:!0},stonesoup:{corename:"Dungeon Crawl Stone Soup"},superbroswar:{corename:"superbroswar"},swanstation:{corename:"SwanStation",savestate:!0},tempgba:{corename:"TempGBA"},test:{corename:"Test",supportsNoGame:!0},test_netplay:{corename:"netplay-test",supportsNoGame:!0},testaudio_callback:{corename:"TestAudio Callback",supportsNoGame:!0},testaudio_no_callback:{corename:"TestAudio NoCallback",supportsNoGame:!0},testaudio_playback_wav:{corename:"TestAudio Playback Wav",supportsNoGame:!0},testgl:{corename:"TestGL",supportsNoGame:!0},testgl_compute_shaders:{corename:"TestGL ComputeShaders",supportsNoGame:!0},testgl_ff:{corename:"TestGL (FF)",supportsNoGame:!0},testinput_buttontest:{corename:"Button Test",supportsNoGame:!0},testretroluxury:{corename:"Test RetroLuxury",supportsNoGame:!0},testsw:{corename:"TestSW",supportsNoGame:!0},testsw_vram:{corename:"TestSW VRAM",supportsNoGame:!0},testvulkan:{corename:"TestVulkan",supportsNoGame:!0},testvulkan_async_compute:{corename:"TestVulkan AsyncCompute",supportsNoGame:!0},tgbdual:{corename:"TGB Dual",savestate:!0},theodore:{corename:"theodore",savestate:!0,supportsNoGame:!0},thepowdertoy:{corename:"ThePowderToy",savestate:!0,supportsNoGame:!0},tic80:{cheats:!0,corename:"TIC-80",savestate:!0},tyrquake:{cheats:!0,corename:"TyrQuake"},uae4arm:{corename:"UAE4ARM",savestate:!0},ume2015:{corename:"UME 2015 (0.160)"},uw8:{corename:"MicroW8",savestate:!0},uzem:{savestate:!0},vaporspec:{corename:"VaporSpec",savestate:!0},vba_next:{corename:"VBA Next",savestate:!0},vbam:{cheats:!0,corename:"VBA-M",savestate:!0},vecx:{savestate:!0},vemulator:{corename:"VeMUlator"},vice_x128:{cheats:!0,corename:"VICE x128",savestate:!0,supportsNoGame:!0},vice_x64:{cheats:!0,corename:"VICE x64",savestate:!0,supportsNoGame:!0},vice_x64dtv:{cheats:!0,corename:"VICE x64dtv",savestate:!0,supportsNoGame:!0},vice_x64sc:{cheats:!0,corename:"VICE x64sc",savestate:!0,supportsNoGame:!0},vice_xcbm2:{cheats:!0,corename:"VICE xcbm2",savestate:!0,supportsNoGame:!0},vice_xcbm5x0:{cheats:!0,corename:"VICE xcbm5x0",savestate:!0,supportsNoGame:!0},vice_xpet:{cheats:!0,corename:"VICE xpet",savestate:!0,supportsNoGame:!0},vice_xplus4:{cheats:!0,corename:"VICE xplus4",savestate:!0,supportsNoGame:!0},vice_xscpu64:{cheats:!0,corename:"VICE xscpu64",savestate:!0,supportsNoGame:!0},vice_xvic:{cheats:!0,corename:"VICE xvic",savestate:!0,supportsNoGame:!0},vircon32:{corename:"Vircon32",supportsNoGame:!0},virtualjaguar:{corename:"Virtual Jaguar"},virtualxt:{},vitaquake2:{corename:"vitaQuake 2"},"vitaquake2-rogue":{corename:"vitaQuake 2 [Rogue]"},"vitaquake2-xatrix":{corename:"vitaQuake 2 [Xatrix]"},"vitaquake2-zaero":{corename:"vitaQuake 2 [Zaero]"},vitaquake3:{corename:"vitaQuake 3"},vitavoyager:{corename:"vitaVoyager"},wasm4:{corename:"WASM-4",savestate:!0},x1:{},x64sdl:{corename:"VICE SDL"},xrick:{corename:"XRick",supportsNoGame:!0},yabasanshiro:{cheats:!0,corename:"YabaSanshiro",savestate:!0},yabause:{cheats:!0,corename:"Yabause",savestate:!0}},Q={add:"NumpadAdd",alt:"AltLeft",backquote:"Backquote",backslash:"",backspace:"Backspace",capslock:"CapsLock",comma:"Comma",ctrl:"ControlLeft",del:"Delete",divide:"NumpadDivide",down:"ArrowDown",end:"End",enter:"Enter",equals:"Equal",escape:"Escape",home:"Home",insert:"Insert",kp_enter:"NumpadEnter",kp_equals:"NumpadEquals",kp_minus:"NumpadSubtract",kp_period:"NumpadDecimal",kp_plus:"NumpadAdd",left:"ArrowLeft",leftbracket:"BracketLeft",minus:"Minus",multiply:"NumpadMultiply",numlock:"NumLock",pagedown:"PageDown",pageup:"PageUp",pause:"Pause",period:"Period",print_screen:"PrintScreen",quote:"Quote",ralt:"AltRight",rctrl:"ControlRight",right:"ArrowRight",rightbracket:"BracketRight",rshift:"ShiftRight",scroll_lock:"ScrollLock",semicolon:"Semicolon",shift:"ShiftLeft",slash:"Slash",space:"Space",subtract:"NumpadSubtract",tab:"Tab",tilde:"",up:"ArrowUp"};const{ini:Y,path:Z}=h,ee="/home/web_user/retroarch/userdata",te="/home/web_user/retroarch/bundle",ae=Z.join(ee,"content"),se=Z.join(ee,"system"),ne=Z.join(ee,"config"),re=Z.join(ee,"screenshots"),oe=Z.join(te,"shaders","shaders_glsl"),ie=Z.join(oe,"shaders"),ce=Z.join(ee,"retroarch.cfg"),le=Z.join(ee,"retroarch-core-options.cfg"),ue=class e{constructor({emscriptenModule:e,signal:t}){r(this,"emscriptenModule"),r(this,"signal"),this.emscriptenModule=e,this.signal=t}get FS(){return this.emscriptenModule.FS}static async create(...t){const a=new e(...t);return await a.prepare(),a}mkdirTree(e){const{FS:t}=this;t.mkdirTree(e)}readFile(e,t="utf8"){const{FS:a}=this;return a.readFile(e,{encoding:t})}unlink(e){const{FS:t}=this;try{t.unlink(e)}catch{}}async waitForFile(e){let t,a=!1,s=0;for(;s<=30&&!a;){const n=Math.min(100*2**s,1e3);await A(n),M(this.signal);try{const s=this.readFile(e,"binary").buffer;t&&(a=t.byteLength>0&&t.byteLength===s.byteLength),t=s}catch(e){console.warn(e)}s+=1}if(!a||!t)throw new Error("fs timeout");return t}async writeFile(e,t){const{FS:a}=this,s=Z.dirname(e),n=Z.basename(e),r=await b.create(t),o=await r.getUint8Array();a.createDataFile("/",n,o,!0,!1);const i="binary",c=this.readFile(n,i);this.mkdirTree(s),a.writeFile(e,c,{encoding:i}),this.unlink(n)}async writeIni(e,t){if(!t)return;const a={};for(const e in t)a[e]=`__${t[e]}__`;const s=Y.stringify(a,{platform:"linux",whitespace:!0}).replaceAll("__",'"');await this.writeFile(e,s)}async prepare(){const e=[ne,ae,oe,ie,se];for(const t of e)this.mkdirTree(t);let t=0;for(;!this.emscriptenModule.asm&&t<100;)await A(10),M(this.signal),t+=5}};r(ue,"bundleDirectory",te),r(ue,"configDirectory",ne),r(ue,"configPath",ce),r(ue,"contentDirectory",ae),r(ue,"coreConfigPath",le),r(ue,"screenshotsDirectory",re),r(ue,"shaderDirectory",oe),r(ue,"systemDirectory",se),r(ue,"userdataDirectory",ee);let me=ue;const{ini:he,path:pe}=h;class fe{constructor(e){r(this,"canvasInitialSize",{height:0,width:0}),r(this,"emscripten"),r(this,"eventListeners",{beforeLaunch:[],onLaunch:[]}),r(this,"fileSystem"),r(this,"gameStatus","initial"),r(this,"messageQueue",[]),r(this,"options"),this.options=e}get coreFullName(){const{core:e}=this.options,t=K[e.name].corename||e.name;if(!t)throw new Error(`invalid core name: ${e.name}`);return t}get fs(){if(!this.fileSystem)throw new Error("fileSystem is not ready");return this.fileSystem}get romBaseName(){const{rom:[{baseName:e}]}=this.options;return e}get sramFileDirectory(){return pe.join(me.userdataDirectory,"saves",this.coreFullName)}get sramFilePath(){return pe.join(this.sramFileDirectory,`${this.romBaseName}.srm`)}get stateFileDirectory(){return pe.join(me.userdataDirectory,"states",this.coreFullName)}get stateFilePath(){return pe.join(this.stateFileDirectory,`${this.romBaseName}.state`)}get stateThumbnailFilePath(){return`${this.stateFilePath}.png`}callCommand(e){var t;const{Module:a}=this.getEmscripten();null==(t=a[e])||t.call(a)}exit(e=0){try{const{exit:t,JSEvents:a}=this.getEmscripten();t(e),a.removeAllEventListeners()}catch{}this.gameStatus="terminated"}getEmscripten(){if(!this.emscripten)throw new Error("emulator is not ready");return this.emscripten}getOptions(){return this.options}getStatus(){return this.gameStatus}async launch(){const{element:e,respondToGlobalEvents:t,signal:a,style:s,waitForInteraction:n}=this.options;if(function(e,t){if(e)for(const a in t){const s=t[a];e.style[a]=s||null}}(e,s),e.isConnected||(document.body.append(e),null==a||a.addEventListener("abort",(()=>{null==e||e.remove()}))),this.canvasInitialSize=this.getElementSize(),!1===t){e.tabIndex&&-1!==e.tabIndex||(e.tabIndex=0);const{activeElement:t}=document;e.focus(),null==a||a.addEventListener("abort",(()=>{t instanceof HTMLElement&&t.focus()}))}await this.runEventListeners("beforeLaunch"),n?n({done:async()=>{this.runMain(),await this.runEventListeners("onLaunch")}}):(this.runMain(),await this.runEventListeners("onLaunch"))}async loadState(e){this.clearStateFile(),await this.fs.writeFile(this.stateFilePath,e),await this.fs.waitForFile(this.stateFilePath),this.sendCommand("LOAD_STATE")}on(e,t){return this.eventListeners[e].push(t),this}pause(){"running"===this.gameStatus&&this.sendCommand("PAUSE_TOGGLE"),this.gameStatus="paused"}async press(e,t=1,a=100){const s=this.getKeyboardCode(e,t);s&&await this.keyboardPress(s,a)}pressDown(e,t=1){const a=this.getKeyboardCode(e,t);a&&this.keyboardDown(a)}pressUp(e,t=1){const a=this.getKeyboardCode(e,t);a&&this.keyboardUp(a)}resize({height:e,width:t}){const{Module:a}=this.getEmscripten();"number"==typeof t&&"number"==typeof e&&a.setCanvasSize(t,e)}restart(){this.sendCommand("RESET"),this.resume()}resume(){"paused"===this.gameStatus&&this.sendCommand("PAUSE_TOGGLE"),this.gameStatus="running"}async saveSRAM(){this.fs.unlink(this.sramFilePath),this.callCommand("_cmd_savefiles");const e=await this.fs.waitForFile(this.sramFilePath);return new Blob([e],{type:"application/octet-stream"})}async saveState(){this.clearStateFile(),this.sendCommand("SAVE_STATE");let e,t;this.options.retroarchConfig.savestate_thumbnail_enable?[e,t]=await Promise.all([this.fs.waitForFile(this.stateFilePath),this.fs.waitForFile(this.stateThumbnailFilePath)]):e=await this.fs.waitForFile(this.stateFilePath),this.clearStateFile();return{state:new Blob([e],{type:"application/octet-stream"}),thumbnail:t?new Blob([t],{type:"image/png"}):void 0}}async screenshot(){this.sendCommand("SCREENSHOT");const e=this.guessScreenshotFileName(),t=pe.join(me.screenshotsDirectory,e),a=await this.fs.waitForFile(t);return this.fs.unlink(t),new Blob([a],{type:"image/png"})}sendCommand(e){const t=_.encode(`${e}\n`);this.messageQueue.push([t,0])}async setup(){await this.setupEmscripten(),await this.setupFileSystem()}clearStateFile(){try{this.fs.unlink(this.stateFilePath),this.fs.unlink(this.stateThumbnailFilePath)}catch{}}fireKeyboardEvent(e,t){const{JSEvents:a}=this.getEmscripten();for(const{eventListenerFunc:s,eventTypeString:n}of a.eventHandlers)if(n===e)try{s({code:t,target:this.options.element})}catch{}}getCurrentRetroarchConfig(){const e=this.fs.readFile(me.configPath);return he.parse(e)}getElementSize(){const{element:e,size:t}=this.options;return t&&"auto"!==t?t:{height:e.offsetHeight,width:e.offsetWidth}}getKeyboardCode(e,t=1){const a=this.getCurrentRetroarchConfig()[`input_player${t}_${e}`];if(!a||"nul"===a)return;const{length:s}=a;return 1===s?`Key${a.toUpperCase()}`:"f"!==a[0]||2!==s&&3!==s?4===s&&a.startsWith("num")?`Numpad${a.at(-1)}`:7===s&&a.startsWith("keypad")?`Digit${a.at(-1)}`:Q[a]||"":a.toUpperCase()}guessScreenshotFileName(){const e=new Date,t=`${e.getFullYear()%1e3}${N(e.getMonth()+1)}${N(e.getDate())}-${N(e.getHours())}${N(e.getMinutes())}${N(e.getSeconds())}`;return`${this.romBaseName}-${t}.png`}keyboardDown(e){this.fireKeyboardEvent("keydown",e)}async keyboardPress(e,t=100){this.keyboardDown(e),await A(t),this.keyboardUp(e)}keyboardUp(e){this.fireKeyboardEvent("keyup",e)}postRun(){var e;this.resize(this.canvasInitialSize);for(const t of(null==(e=navigator.getGamepads)?void 0:e.call(navigator))??[])t&&globalThis.dispatchEvent(new GamepadEvent("gamepadconnected",{gamepad:t}));this.updateKeyboardEventHandlers()}async runEventListeners(e){const{[e]:t}=this.eventListeners;for(const e of t)await e()}runMain(){M(this.options.signal);const{Module:e}=this.getEmscripten(),{arguments:t=[]}=e,{rom:a,signal:s}=this.options;if(!e.arguments&&a.length>0){const[{name:e}]=a;t.push(pe.join(me.contentDirectory,e))}e.callMain(t),null==s||s.addEventListener("abort",(()=>{this.exit()})),this.gameStatus="running",this.postRun()}async setupEmscripten(){var e;"object"==typeof globalThis&&(globalThis.setImmediate??(globalThis.setImmediate=globalThis.setTimeout));const{core:t,element:a,emscriptenModule:s}=this.options,{wasm:n}=t,r=function(e){let t;const a=new Promise((e=>{t=e}));return{noExitRuntime:!1,noInitialRun:!0,locateFile:e=>e,monitorRunDependencies:async e=>(0===e&&t(),await a),print(...e){console.info(...e)},printErr(...e){console.error(...e)},quit(e,t){e&&console.info(e,t)},...e}}({canvas:a,preRun:[],wasmBinary:await n.getArrayBuffer(),...s});null==(e=r.preRun)||e.push((()=>r.FS.init((()=>this.stdin()))));const{getEmscripten:o}=await async function({js:e,name:t}){const a=await async function({js:e,name:t}){let a=await e.getText();return function(e){return e.startsWith("var Module")}(a)?a=`export function getEmscripten({ Module }) {\n        ${a};\n        Module.FS = FS;\n        Module.PATH = PATH;\n        Module.ERRNO_CODES = ERRNO_CODES;\n        return {\n          AL: typeof AL === 'undefined' ? null: AL,\n          Browser: typeof Browser === 'undefined' ? null: Browser,\n          JSEvents,\n          Module,\n          exit: _emscripten_force_exit\n         }\n      }`:function(e){return e.includes("import.meta.url")}(a)&&(a=`${a.replace("readyPromiseResolve(Module)","readyPromiseResolve({\n        AL: typeof AL === 'undefined' ? null: AL,\n        Browser: typeof Browser === 'undefined' ? null: Browser,\n        JSEvents,\n        Module,\n        exit: _emscripten_force_exit\n      })")};\n      export function getEmscripten({ Module }) {\n        return (libretro_${t} || ${t})(Module)\n      }\n    `),a}({js:e,name:t}),s=await b.create({blobType:"application/javascript",raw:a}),n=s.getObjectUrl();try{return await import(n)}catch{return await new Function(`return import('${n}')`)()}finally{s.dispose()}}(t);M(this.options.signal);const i=await o({Module:r});M(this.options.signal),this.emscripten=i;const{Module:c}=i;await c.monitorRunDependencies(),M(this.options.signal)}async setupFileSystem(){const{Module:e}=this.getEmscripten(),{bios:t,rom:a,signal:s,sram:n,state:r}=this.options;for(const{name:e}of t)if(!e)throw new Error("file name is required for bios");const o=await me.create({emscriptenModule:e,signal:s});this.fileSystem=o,r&&this.fs.mkdirTree(this.stateFileDirectory),n&&this.fs.mkdirTree(this.sramFileDirectory);const i=[];i.push(...a.map((e=>this.fs.writeFile(pe.join(me.contentDirectory,e.name),e))),...t.map((e=>this.fs.writeFile(pe.join(me.systemDirectory,e.name),e)))),r&&i.push(this.fs.writeFile(`${this.stateFilePath}.auto`,r)),n&&i.push(this.fs.writeFile(this.sramFilePath,n)),await Promise.all(i),M(s),await this.setupRaConfigFiles(),M(this.options.signal)}async setupRaConfigFiles(){await this.fs.writeIni(me.configPath,this.options.retroarchConfig),await this.fs.writeIni(me.coreConfigPath,this.options.retroarchCoreConfig),await this.setupRaShaderFiles()}async setupRaShaderFiles(){const{shader:e}=this.options;if(0===e.length)return;const t=e.filter((e=>e.name.endsWith(".glslp")));if(0===t.length)return;for(const{name:t}of e)if(!t)throw new Error("file name is required for shader");const a=t.map((e=>`#reference "${pe.join(me.shaderDirectory,e.name)}"`)).join("\n");await this.fs.writeFile(pe.join(me.configDirectory,"global.glslp"),a),await Promise.all(e.map((async e=>{const t=".glslp"===e.extension?me.shaderDirectory:pe.join(me.shaderDirectory,"shaders");await this.fs.writeFile(pe.join(t,e.name),e)})))}stdin(){const{messageQueue:e}=this;for(;e.length>0;){const t=e[0][0],a=e[0][1];if(!(a>=t.length))return e[0][1]=a+1,t[a];e.shift()}return null}updateKeyboardEventHandlers(){const{JSEvents:e}=this.getEmscripten(),{element:t,respondToGlobalEvents:a}=this.options;a||(t.getAttribute("tabindex")||(t.tabIndex=-1),t.focus(),t.addEventListener("click",(()=>{t.focus()})));const s=new Set(["keydown","keypress","keyup"]),n=e.eventHandlers.filter((({eventTypeString:e,target:a})=>s.has(e)&&(a===document||a===t)));for(const s of n){const{eventTypeString:n,handlerFunc:r,target:o}=s;e.registerOrRemoveHandler({eventTypeString:n,target:o}),e.registerOrRemoveHandler({...s,handlerFunc:(...e)=>{const[s]=e;(a||(null==s?void 0:s.target)===t)&&r(...e)},target:a?document:t})}}}const de=class e{constructor(e){r(this,"emulator"),r(this,"emulatorOptions"),r(this,"options");const t={};T(t,q(),e),this.options=t}static clearCache(){J.resetCacheStore()}static configure(e){!function(e){T(V,e)}(e)}static async gb(t){return await e.launchSystem("gb",t)}static async gba(t){return await e.launchSystem("gba",t)}static async gbc(t){return await e.launchSystem("gbc",t)}static async launch(t){const a=new e(t);return await a.load(),a}static async megadrive(t){return await e.launchSystem("megadrive",t)}static async nes(t){return await e.launchSystem("nes",t)}static async prepare(t){const a=new e({...t,runEmulatorManually:!0});return await a.load(),a}static resetToDefault(){V=z()}static async snes(t){return await e.launchSystem("snes",t)}static async launchSystem(t,a){const s=await P(a),n=O(s)?{rom:s}:s;return await e.launch({...n,core:o[t]})}exit({removeCanvas:e=!0}={}){this.getEmulator().exit(),e&&this.getCanvas().remove()}getCanvas(){return this.getEmulatorOptions().element}getEmscripten(){return this.getEmulator().getEmscripten()}getEmscriptenAL(){return this.getEmulator().getEmscripten().AL}getEmscriptenFS(){return this.getEmulator().getEmscripten().Module.FS}getEmscriptenModule(){return this.getEmulator().getEmscripten().Module}getEmulator(){const{emulator:e}=this;if(!e)throw new Error("emulator is not ready");return e}getEmulatorOptions(){if(!this.emulatorOptions)throw new Error("emulator options are not ready");return this.emulatorOptions}getOptions(){return this.options}getStatus(){return this.getEmulator().getStatus()}async launchEmulator(){return await this.start()}async loadState(e){const t=await b.create(e);await this.getEmulator().loadState(t)}pause(){this.getEmulator().pause()}async press(e){const t=this.getEmulator();await("string"==typeof e?t.press(e):t.press(e.button,e.player,e.time))}pressDown(e){const t=this.getEmulator();return"string"==typeof e?t.pressDown(e):t.pressDown(e.button,e.player)}pressUp(e){const t=this.getEmulator();return"string"==typeof e?t.pressUp(e):t.pressUp(e.button,e.player)}resize(e){return this.getEmulator().resize(e)}restart(){this.getEmulator().restart()}resume(){this.getEmulator().resume()}async saveSRAM(){const e=this.getEmulator();return await e.saveSRAM()}async saveState(){return await this.getEmulator().saveState()}async screenshot(){const e=this.getEmulator();return await e.screenshot()}sendCommand(e){return this.getEmulator().sendCommand(e)}async start(){return await this.getEmulator().launch()}async load(){this.emulatorOptions=await J.create(this.options),M(this.options.signal),this.options.setupEmulatorManually||(await this.setupEmulator(),this.options.runEmulatorManually||await this.start())}async setupEmulator(){const e=this.getEmulatorOptions();this.emulator=new fe(e),this.emulator.on("onLaunch",(()=>{var e,t;return null==(t=(e=this.options).onLaunch)?void 0:t.call(e,this)})).on("beforeLaunch",(()=>{var e,t;return null==(t=(e=this.options).beforeLaunch)?void 0:t.call(e,this)})),await this.emulator.setup()}};r(de,"Nostalgist",de),r(de,"vendors",h);let ge=de},96:(e,t,a)=>{"use strict";a.a(e,(async(e,t)=>{try{var s=a(13);let e="/apps/nostalgist/img/app.svg";s.x.configure({element:document.querySelector(".nostalgist canvas"),resolveCoreJs:t=>e.replace("app.svg",`cores/${t}_libretro.js`),resolveCoreWasm:t=>e.replace("app.svg",`cores/${t}_libretro.wasm`),retroarchConfig:{rewind_enable:!1}}),await s.x.launch({core:"fceumm",rom:"https://nextcloud.ddev.site/s/t3Rcinx6YtR4ZGd/download/Super%20Mario%20Bros%20%28E%29.nes"}),t()}catch(e){t(e)}}),1)},606:e=>{var t,a,s=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(a){try{return t.call(null,e,0)}catch(a){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{a="function"==typeof clearTimeout?clearTimeout:r}catch(e){a=r}}();var i,c=[],l=!1,u=-1;function m(){l&&i&&(l=!1,i.length?c=i.concat(c):u=-1,c.length&&h())}function h(){if(!l){var e=o(m);l=!0;for(var t=c.length;t;){for(i=c,c=[];++u<t;)i&&i[u].run();u=-1,t=c.length}i=null,l=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===r||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{return a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];c.push(new p(e,t)),1!==c.length||l||o(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var a=r[e]={exports:{}};return n[e](a,a.exports,o),a.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",a="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},o.a=(n,r,o)=>{var i;o&&((i=[]).d=-1);var c,l,u,m=new Set,h=n.exports,p=new Promise(((e,t)=>{u=t,l=e}));p[t]=h,p[e]=e=>(i&&e(i),m.forEach(e),p.catch((e=>{}))),n.exports=p,r((n=>{var r;c=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[e])return n;if(n.then){var r=[];r.d=0,n.then((e=>{o[t]=e,s(r)}),(e=>{o[a]=e,s(r)}));var o={};return o[e]=e=>e(r),o}}var i={};return i[e]=e=>{},i[t]=n,i})))(n);var o=()=>c.map((e=>{if(e[a])throw e[a];return e[t]})),l=new Promise((t=>{(r=()=>t(o)).r=0;var a=e=>e!==i&&!m.has(e)&&(m.add(e),e&&!e.d&&(r.r++,e.push(r)));c.map((t=>t[e](a)))}));return r.r?l:o()}),(e=>(e?u(p[a]=e):l(h),s(i)))),i&&i.d<0&&(i.d=0)},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);o(96)})();
//# sourceMappingURL=main.js.map